@page "/DataSources"
@using TheGrid.Shared.Models;

<PageTitle>Data Sources</PageTitle>

<RadzenText TextStyle="TextStyle.DisplayH2">Data Sources</RadzenText>

<RadzenDataGrid
    Data="_dataSources"
    Count="_totalItems"
    TItem="DataSourceListItem"
    AllowSorting>
    <Columns>
        <RadzenDataGridColumn TItem="DataSourceListItem" Property="@nameof(DataSourceListItem.Name)" Title="Name" />
        <RadzenDataGridColumn TItem="DataSourceListItem" Property="@nameof(DataSourceListItem.QueryRunnerId)" Title="Runner" />
    </Columns>
</RadzenDataGrid>

@code {
    private IEnumerable<DataSourceListItem> _dataSources = Enumerable.Empty<DataSourceListItem>();
    private int _totalItems;

    [CascadingParameter]
    private UserOrganization UserOrganization { get; set; }

    [Inject]
    private HttpClient HttpClient { get; set; } = null!;

    protected override async Task OnInitializedAsync()
    {
        var response = await HttpClient.GetAsync("/api/v1/DataSources?organization=" + UserOrganization.Slug);
        _dataSources = await response.Content.ReadFromJsonAsync<IEnumerable<DataSourceListItem>>();
    }
}
